generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Residential {
  id          BigInt   @id @default(autoincrement())
  createDate  DateTime @default(now()) @db.Timestamp
  country     String   @db.VarChar(2)
  subdivision String
  city        String
  isp         String
  asn         Int
  nodes       Int

  // Many-to-many relation with ZipCode
  zipCodes    ResidentialZipCode[]

  @@unique([country, subdivision, city, isp, asn])
  @@map("residential")
}

model ZipCode {
  id          BigInt   @id @default(autoincrement())
  zip         String   @unique
  country     String   @db.VarChar(2)
  subdivision String
  city        String
  createDate  DateTime @default(now()) @db.Timestamp

  // Many-to-many relation with Residential
  residentials ResidentialZipCode[]

  @@map("zip_codes")
  @@index([country, subdivision, city])
}

model ResidentialZipCode {
  id            BigInt      @id @default(autoincrement())
  residentialId BigInt
  zipCodeId     BigInt
  createDate    DateTime    @default(now()) @db.Timestamp

  residential   Residential @relation(fields: [residentialId], references: [id], onDelete: Cascade)
  zipCode       ZipCode     @relation(fields: [zipCodeId], references: [id], onDelete: Cascade)

  @@unique([residentialId, zipCodeId])
  @@map("residential_zip_codes")
}